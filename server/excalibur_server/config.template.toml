################################################################################
#         ________   _______          _      _____ ____  _    _ _____          #
#        |  ____\ \ / / ____|   /\   | |    |_   _|  _ \| |  | |  __ \         #
#        | |__   \ V / |       /  \  | |      | | | |_) | |  | | |__) |        #
#        |  __|   > <| |      / /\ \ | |      | | |  _ <| |  | |  _  /         #
#        | |____ / . \ |____ / ____ \| |____ _| |_| |_) | |__| | | \ \         #
#        |______/_/ \_\_____/_/    \_\______|_____|____/ \____/|_|  \_\        #
#                                                                              #
#                     Excalibur Server Configuration File                      #
#                                                                              #
################################################################################

# Config file version. DO NOT EDIT THIS FIELD!
version = 1

# -----------------------------------------------------------------------------
# Server & Network Configuration
#
# Settings related to the web server, network access, and request handling.
# -----------------------------------------------------------------------------
[server]
# The allowed origins for Cross-Origin Resource Sharing (CORS)
allow_origins = [
    "capacitor://localhost", # Capacitor on iOS
    "http://localhost",      # Capacitor on Android
    "http://localhost:5173", # Vite development server
    "http://localhost:8100", # Local development server for Ionic
]

[server.rate_limit]
# The capacity of the rate limiter (e.g., number of allowed bursts)
capacity = 20

# The refill rate of the rate limiter, in tokens per second
refill_rate = 1

# -----------------------------------------------------------------------------
# Storage Configuration
#
# Settings for file storage, database, and data handling.
# -----------------------------------------------------------------------------
[storage]
# The vault folder for storing user files, relative to the application root
vault_folder = "vault"

# The maximum file size that can be uploaded, in bytes
max_upload_size = 52_428_800 # 50 MiB

# The maximum size for an uploaded file to be held in memory before being written to a temporary
# file on disk, in bytes
max_spool_size = 1_048_576 # 1 MiB

# The chunk size to use when writing files to disk, in bytes
write_chunk_size = 65536 # 64 KiB

# The chunk size to use when sending files to the client, in bytes
send_chunk_size = 131072 # 128 KiB

[storage.database]
# The database file path, relative to the application root
file = "excalibur.duckdb"

# -----------------------------------------------------------------------------
# Security Configuration
#
# Settings related to authentication, sessions, and cryptography.
# -----------------------------------------------------------------------------
[security]
# How long a login session lasts, in seconds
session_duration = 3600 # 1 hour

[security.srp]
# Secure Remote Password (SRP) group size for authentication
# Valid values (case insensitive): "small", "medium", "large"
group = "small"

[security.e2ee]
# The maximum number of end-to-end encryption communication sessions to cache
comm_cache_size = 1024

[security.pop]
# The maximum number of Proof-of-Possession (PoP) nonces to cache
nonce_cache_size = 8192

# How long a received Proof-of-Possession (PoP) timestamp is considered valid, in seconds
timestamp_validity = 60

# -----------------------------------------------------------------------------
# Logging Configuration
#
# Settings for application logging.
# -----------------------------------------------------------------------------
[logging]
# The directory to store log files in
directory = "logs"

# A list of API endpoints to exclude from access logs
no_log_endpoints = ["/api/well-known/heartbeat"]

[logging.format]
# The default log format for console output
default = "[%(asctime)s] %(levelprefix)s %(message)s"

# The log format for API access logs
access = '[%(asctime)s] %(levelprefix)s %(client_addr)s - "%(request_line)s" %(status_code)s'

# The log format when writing to files
file = "[%(asctime)s] %(levelname)s - %(message)s"
